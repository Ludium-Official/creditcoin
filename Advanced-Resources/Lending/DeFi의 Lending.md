# 1. DeFi의 Lending
### Lending이란?
DeFi(Decentralized Finance)는 블록체인 기술을 기반으로 하는 탈중앙화 금융 생태계를 의미하며, 은행이나 증권사와 같은 중앙기관 없이 스마트컨트랙트를 통해 다양한 금융 서비스를 제공한다. 이 가운데 Lending(대출)은 DeFi의 핵심 서비스 중 하나로, 사용자는 암호화폐를 예치하여 이자를 얻거나, 담보를 맡기고 자산을 빌릴 수 있다.

![DeFi Lending 구조](DeFi의%20Lending/file-20250819190731775.png)

Lending은 기본적으로 P2P 방식의 암호화폐 대출 구조를 따르며, 예치자(Lender)는 자신의 암호자산을 렌딩 풀(Lending Pool)에 맡겨 이자를 받을 수 있다. 이 과정은 스마트컨트랙트를 통해 자동으로 실행되므로, 중개기관 없이도 예치와 대출이 가능하다.

즉, 기존 중앙화 금융에서 대출 창구의 역할을 은행이 수행했다면, DeFi에서는 스마트컨트랙트가 그 역할을 대신하는 구조라고 볼 수 있다.

<span style="color:rgb(255, 0, 0)">렌딩 풀 같은 전문단어도 자세히 설명해주는 버전 + "사람" 그림 => 전"통 금융 시장 or DeFi 시장" 그림으로
약간 수정 필요</span>

### Lengding과 전통 금융과의 차별점
Lending은 Web3 기반의 대출 서비스인 만큼, 전통 금융과는 몇 가지 뚜렷한 차이점을 가진다.

우선 기존 중앙화 금융에서는 은행 대출을 받기 위해 신용평가와 심사 절차를 거쳐야 하며, 이 과정이 오래 걸릴 뿐만 아니라 심사 기준과 절차가 외부에 공개되지 않아 불투명하다. 반면 DeFi의 Lending은 담보 조건만 충족되면 누구나 즉시 대출이 가능하며, 그 조건과 실행 과정이 모두 스마트컨트랙트에 의해 자동으로 처리되고 공개적으로 검증 가능하다.

또한 기존 금융에서는 계좌 개설, 신용 등급, 국적, 거주 국가의 규제 등 다양한 제약이 뒤따르지만, DeFi에서는 단순히 Web3 지갑만 있으면 전 세계 어디서든지 자유롭게 참여할 수 있다.

게다가 전통 금융의 대출 기록과 승인 여부는 내부 시스템에만 저장되어 사용자가 그 기준이나 평가 과정을 확인하기 어렵지만, DeFi Lending에서는 모든 트랜잭션 내역과 규칙이 블록체인에 기록되어 누구나 열람하고 검증할 수 있다.

이처럼 Lending은 전통 금융이 가진 지연성, 폐쇄성, 중앙집중성을 극복하고, 빠르고 투명한 탈중앙화 금융 서비스로 자리잡고 있다.


# 2. Lending의 대표 프로토콜(Aave, Morpho)
### Aave
DeFi Lending에서 대표적인 프로토콜에는 Aave가 있다. Aave는 DeFi 생태계에서 가장 널리 사용되는 Lending 프로토콜 중 하나로, 현재 수십억 달러 규모의 자산이 예치되어 있다. 사용자는 암호화폐를 예치해 유동성을 공급하고, 대출자는 해당 풀에서 자산을 빌려 사용할 수 있다. 모든 예치와 대출 과정은 스마트컨트랙트를 통해 자동으로 처리된다.

Aave의 공식 웹사이트([https://app.aave.com](https://app.aave.com))에서는 다음과 같은 정보를 실시간으로 확인할 수 있다:
- **Total Supplied**: 전체 예치된 자산의 양
- **Supply APY**: 예치 자산에 대한 연 수익률
- **Total Borrowed**: 전체 차입된 자산의 양
- **Borrow APY (Variable)**: 대출자가 부담해야 하는 변동 이자율

![Aave 프로토콜](DeFi의%20Lending/file-20250819182632312.png)


Aave의 가장 큰 특징 중 하나는 플래시 론(Flash Loan)이다. 플래시 론은 담보 없이도 하나의 트랜잭션 내에서 자산을 대출하고 즉시 상환하는 구조의 초단기 대출하는 기능이다. 단, 트랜잭션이 종료되기 전까지 반드시 빌린 자금을 모두 상환해야 하며, 그렇지 않으면 해당 트랜잭션 전체가 취소된다.

플래시 론은 다음과 같은 목적에 자주 사용된다

- **차익거래(Arbitrage)** : 가장 일반적인 활용 방식으로, 여러 거래소 간 자산 가격 차이를 이용해 무위험 수익을 추구한다. 예를 들어 Uniswap에서는 ETH 가격이 1,000달러, Curve에서는 1,010달러인 경우, 플래시 론을 통해 ETH를 빌려 Curve에 팔고 Uniswap에서 다시 매수해 상환하면 차익이 발생할 수 있기에 이러한 기회를 얻기 위해 대부분 자동화된 봇들이 선점하고 있다.

- **리파이낸싱(Refinancing)** : 사용자가 Aave 같은 프로토콜에 담보를 걸고 대출받았는데, 해당 대출의 이자가 높은 경우, 플래시 론으로 기존 대출을 상환하고 더 낮은 이자율의 다른 프로토콜에서 새롭게 대출을 받아 비용을 절약하는 전략이다. 일종의 ‘대출 갈아타기’ 방식과 유사하다.

- **청산(Liquidation)** : 다른 사용자가 담보 부족으로 청산 대상이 되었을 때, 플래시 론을 통해 자금을 일시적으로 빌려 해당 사용자의 부채를 상환하고, 그에 대한 보상(Liquidation Bonus)을 획득하는 방식이다. 이는 DeFi에서 꽤 자주 사용되는 전략이기도 하다.

### Morpho
앞서 설명한 Aave는 강력한 유동성 풀 기반의 Lending 프로토콜이지만, 구조적인 한계도 존재한다. 모든 사용자가 공동의 유동성 풀(pool)을 공유하다 보니, 예치자가 받을 수 있는 이자와 차입자가 부담해야 할 이자가 평균값으로 맞춰지는 구조를 가진다. 이로 인해 차입자는 다소 높은 이자를 내고, 예치자는 기대보다 낮은 이자를 받는 상황이 발생할 수 있다. 이러한 마진은 전통 금융에서 은행의 이익이 되는 것처럼, 프로토콜의 수익(예: Reserve Factor)으로 귀속된다.

이와 같은 비효율성을 개선하기 위해 등장한 것이 바로 Morpho다. Morpho는 Aave의 유동성 풀을 그대로 활용하면서도, 가능한 경우 예치자와 차입자를 직접 연결(P2P 매칭)하여 거래를 성사시킨다. 이 방식에서는 중간 수수료나 마진이 줄어들기 때문에, 차입자는 더 낮은 금리로 자산을 빌릴 수 있고, 예치자는 더 높은 이자를 받을 수 있다.

즉, Morpho는 Aave가 제공하는 안정적인 인프라 위에, 금리 효율성을 극대화하는 최적화 레이어로 작동한다.


![Morpho 최적화](DeFi의%20Lending/file-20250819185459059.png)

정리하자면, Aave는 대규모 유동성 풀 기반의 안정성과 기능 확장성이 강점인 프로토콜인 반면, Morpho는 그 위에 구축되어 금리 최적화와 사용자 수익 향상에 중점을 둔 P2P 매칭 기반 프로토콜이라는 점에서 차별화된다.

# 3. Interest Bearing Token
### Interest Bearing Token이란?
Interest Bearing Token은 예치 자산의 가치와 이자를 자동으로 반영하는 토큰이다.
사용자가 Aave나 Morpho 같은 Lending 프로토콜에 자산을 예치하면, 해당 예치를 증명하는 Interest Bearing Token이 발급된다. 예를 들어 Aave에서는 aToken이 그 역할을 하며, 사용자는 예치한 자산만큼의 "aToken"을 수령하게 된다.

이 토큰은 단순한 보유 수단이 아니라, 보유 기간에 따라 이자가 자동으로 반영되어 가치를 스스로 증가시키는 구조를 가지고 있다. 사용자는 aToken을 보유하는 것만으로도 예치 원금에 더해 발생한 이자를 얻을 수 있으며, 출금 시에는 이 토큰을 반납함으로써 "원금 + 이자"가 포함된 실제 자산을 돌려받게 된다.

- 예시
	- 1. 사용자가 100 DAI를 Aave에 예치하면, 100 aDAI를 받는다.
	- 2. 시간이 지나면서 aDAI의 가치가 점점 상승한다.
	- 3. 예를 들어, 1 aDAI가 1.02 DAI의 가치가 될 수 있다.
	- 4. 이때 aDAI를 다시 DAI로 교환하면,
	- 5. 이자가 반영된 총 102 DAI를 돌려받게 된다.

Interest Bearing Token의 또 다른 장점은, 단순히 예치 증표 역할을 넘어 다른 프로토콜에서도 담보 자산으로 활용하거나 거래에 사용할 수 있다는 점이다. 즉, 예치된 자산이 이자를 벌어들이는 동시에, 다른 금융 활동에 활용될 수 있어 DeFi 생태계 내에서 자산의 유연성과 활용도를 크게 높여준다. 이러한 구조는 마치 블록처럼 기능을 조합하는 방식이라 하여, DeFi를 ‘Money Legos’라고도 불리운다.

![Interest Bearing Token](DeFi의%20Lending/file-20250819174059105.png)
# 4. 차입 구조와 금리 모델
### 차입 구조
DeFi Lending 프로토콜에서 대출은 담보 기반 구조로 이루어진다. 사용자가 DAI, ETH 등과 같은 자산을 예치하면, 해당 자산은 스마트컨트랙트를 통해 유동성 풀에 저장된다. 예치와 동시에 사용자는 예치 사실을 증명하는 Interest Bearing Token을 받게 되며, 이 토큰은 원금과 이자를 언제든 상환받을 수 있는 권리를 나타낸다.

차입자는 예치된 자산을 담보로 삼아 대출을 받을 수 있다. 다만, 대출 가능 범위는 자산 종류별로 설정된 LTV(Loan-to-Value) 비율에 따라 제한된다. 예를 들어, Aave에서 ETH의 LTV가 80.5%라면, 사용자는 예치한 ETH 가치의 최대 80.5%에 해당하는 자산만 빌릴 수 있다. 이처럼 차입 구조는 안정성을 확보하기 위해 철저히 담보율 규칙에 따라 운영된다.

### 금리 모델
DeFi 대출에서는 차입 시 "변동 금리"와 "고정 금리"라는 두 가지 이자율 모델을 선택할 수 있다. 

변동 금리는 유동성 풀의 수요와 공급에 따라 실시간으로 조정된다. 대출 수요가 많을수록 금리가 상승하고, 수요가 줄면 금리가 하락한다. 따라서 단기적으로 금리가 낮을 때 대출하면 유리할 수 있지만, 예기치 못한 금리 급등 위험이 존재한다. 이 때문에 변동 금리는 주로 단기 차입이나 시장 금리 하락을 예상하는 경우 선택된다.

반면, 고정 금리는 완전히 고정된 값은 아니지만, 대출 시점의 금리에 가까운 수준을 일정하게 유지하려는 구조다. 변동성이 적어 금리 예측이 어려운 상황에서 안정성을 제공하며, 장기 대출에 적합하다. 다만, 유동성이 극도로 부족해질 경우 프로토콜이 금리를 조정할 수 있어 ‘완전한 고정’은 아니라는 점을 고려해야 한다.

정리하자면, DeFi의 차입 구조는 자산 예치와 담보 설정을 기반으로 하며, 금리 모델은 변동성과 안정성이라는 두 가지 선택지를 제공한다. 그리고 이러한 금리 결정은 시장 수급을 반영하는 활용률에 의해 자동 조정됨으로써, 프로토콜은 스스로 균형을 유지하며 운영된다.

# 5. 담보 관련 메커니즘 ( Collateral Factor, Health Factor, Liquidation 등 )
### Collateral Factor
담보 자산의 가격이 급락할 경우, 대출을 실행한 프로토콜이 손실을 입을 수 있기 때문에 이를 방지하기 위한 장치로 담보 비율(Collateral Factor)이 존재한다.  
DeFi에서도 전통 금융과 마찬가지로, 자산의 변동성을 고려하여 일정 비율까지만 대출이 가능하도록 설계되어 있다.

예를 들어 ETH의 담보 비율이 80%이고, ETH의 현재 가격이 10만 달러라면 최대 8만 달러까지만 대출을 받을 수 있다.

### Health Factor
Health Factor는 사용자의 담보 상태가 어느 정도로 안전한지를 수치로 나타낸 지표다.

Health Factor를 계산할 때 필요한 구성 요소는 아래와 같으며, 계산식은 다음과 같다.

```
Health Factor = (담보 가치 × 담보 비율) ÷ 대출 가치
```

 - **담보 가치 (Collateral Value)**
	 - 담보 가치란 사용자가 예치한 자산(예: ETH, DAI, USDC 등)의 현재 시세 기준 총 가치를 말한다. 
	 - 예를 들어, 1 ETH를 담보로 예치하고, 1ETH가 3,000 USDC라면 담보 가치는 "3,000 USDC"이다.
 - **담보 비율 (Collateral Factor / LTV)**
	 - 담보 비율이란 자산의 변동성에 따라 프로토콜이 해당 자산을 담보로 인정해주는 비율이다. 안정적인 자산일수록 높고, 변동성이 큰 자산은 낮게 설정된다.
	 - 예를 들어, USDC와 같은 안정적인 자산은 담보가치의 최대 80%까지 대출이 가능하다. 즉, 1,000 USDC를 담보로 예치하면 최대 800 USDC까지 대출받을 수 있다. 반면, DOGE처럼 변동성이 큰 자산은 위험 관리 차원에서 LTV가 낮게 설정된다. 따라서 1,000 USDC에 해당하는 가치의 DOGE를 담보로 맡기더라도 최대 400 USDC까지만 대출이 가능하다.
 - **대출 가치 (Borrow Value)**
	 - 사용자가 현재 빌린 자산의 총 시가 기준 가치이다. 여러 자산을 빌렸다면 각 자산을 시가로 환산한 후 모두 합산한다
	 - 예를 들어, 사용자가 300 USDC와 0.1 ETH를 빌렸다고 가정하자. 이때 ETH의 시세가 3,000 USDC라면, 0.1 ETH는 300 USDC에 해당한다. 따라서 총 대출 규모는 300 USDC + 200 USDC를 합한 600 USDC로 계산된다.

위 3가지 구성 요소를 이용한 계산 예시는 아래와 같다.

```
담보 가치 (Collateral Value) = 3,000 USDC  
담보 한도 (Collateral Value × 담보 비율) = 3,000 × 0.8 = 2,400 USDC  
대출 가치 (Borrow Value) = 600 USDC  

Health Factor = (담보 가치 × 담보 비율) ÷ 대출 가치
              = (3,000 × 0.8) ÷ 600
              = 2,400 ÷ 600
              = 4.0

```

### Liquidation
만약 Health Factor가 1 이하로 떨어지면, 프로토콜은 자동으로 강제 상환 절차를 실행하게 된다. 이때 청산자는 대출자의 빚을 대신 갚아주고, 그 대가로 담보를 일정 부분 할인된 가격에 가져가 차익을 남기게 된다.

예를 들어, 사용자가 $10,000 상당의 ETH를 담보로 맡기고 $8,000 상당의 DAI를 빌린 경우 Health Factor는 정확히 1.0이다. 그러나 ETH 가격이 $9,000으로 하락하면 Health Factor는 1 이하로 떨어지게 되고, 결국 청산 절차가 발동된다.

이러한 제도가 없다면 대출자가 상환을 거부하거나 도망쳤을 때 프로토콜이 손실을 직접 떠안아야 하므로, 청산 메커니즘은 프로토콜의 안정성을 지키는 핵심 장치라 할 수 있다.


# 6. 오라클(Oracle) 기반 가격 데이터 
Collateral Factor, Health Factor, Liquidation과 같은 지표를 계산하려면, 거래소에서 거래되는 코인의 가격 데이터가 반드시 필요하다. 그러나 블록체인은 외부 세계의 데이터를 직접 불러올 수 없기 때문에, 이를 대신해주는 중개 장치인 오라클(Oracle) 을 활용한다. 오라클은 외부의 실시간 가격, 환율, 날씨, 뉴스 등 다양한 데이터를 블록체인으로 안전하게 가져와, 스마트 컨트랙트가 이를 기반으로 자동 실행될 수 있도록 지원하는 기술이다.

-  **오라클 활용 예시**
	- **가격 피드** : Aave 같은 대출 프로토콜은 BTC, ETH, USDC 등의 실시간 가격을 받아와 담보 가치와 Health Factor를 계산한다.
	-  **스테이블코인** : USDT, USDC 같은 코인이 1달러 가치에 고정되려면 달러 환율 정보를 오라클이 제공해야 한다.
	- **보험 서비스** : 날씨 보험의 경우, 오라클이 기상청 데이터를 받아와 일정량 이상의 비가 내리면 보험금 지급을 자동 실행한다.

-  **오라클의 동작 과정**
	- 1. 스마트 컨트랙트가 외부 데이터(예: 가격 정보)를 요청한다
	- 2. 오라클은 거래소, API 등 여러 소스로부터 데이터를 수집한다.
	- 3. 수집된 데이터가 블록체인에 전달된다.
	- 4. 스마트 컨트랙트는 전달받은 데이터를 기반으로 자동 실행된다. (예: 청산 트리거, 대출 실행 등)
# 7. Brdige and Multi chain liquidity 
### Bridge
블록체인 기술이 발전하면서 다양한 체인이 등장하고, Aave·Morpho와 같은 Lending 프로토콜들은 여러 레이어 및 체인 위에 배포되기 시작했다. 그러나 이렇게 서로 다른 체인에 올라간 Aave 기반 자산들은 체인 간 이동이 불가능하여, 각 체인마다 유동성이 고립되는 비효율적인 구조가 존재했다.

이러한 문제를 해결하기 위해 등장한 개념이 Bridge(브릿지)이다. 브릿지는 서로 다른 블록체인 간에 자산을 옮길 수 있는 통로 역할을 하며, 체인별로 고립되어 있던 자산을 연결해준다.

예를 들어, 사용자가 이더리움 메인넷의 Aave에 예치하여 받은 aUSDC를 아비트럼이나 옵티미즘 같은 L2 네트워크에서 활용하고 싶다고 하자. 과거에는 각 체인마다 별도로 예치해 각각의 aUSDC를 따로 받아야 했기 때문에 불편했지만, 이제는 브릿지를 이용하면 메인넷에서 보유하던 aUSDC를 그대로 다른 체인으로 옮겨 활용할 수 있다.

이를 통해 사용자는 특정 체인에 묶이지 않고 자산을 자유롭게 이동시켜 원하는 네트워크에서 활용할 수 있게 되었고, 결과적으로 자본 효율성이 크게 개선되었다.

### Multi Chain Liquidity
브릿지를 통해 사용자가 체인 간 자산을 이동시킬 수 있게 되었지만, 여전히 유동성 자체는 각 체인에 분리되어 존재한다는 한계가 있었다. 예를 들어, 이더리움의 Aave 풀에는 유동성이 풍부해 금리가 낮은 반면, 아비트럼의 Aave 풀에는 유동성이 부족해 금리가 높은 상황이 발생할 수 있다. 이처럼 체인마다 유동성이 단절되어 있으면 전체 생태계 차원에서 자본 비효율이 지속된다.

이를 해결하기 위해 등장한 개념이 Multi Chain Liquidity(다중 체인 유동성)이다. Multi Chain Liquidity는 여러 체인에 흩어져 있는 유동성을 하나로 연결해 마치 단일 풀처럼 작동하도록 하는 구조이다. 이를 통해 특정 체인에서 유동성이 부족하면 다른 체인의 여유분을 끌어와 균형을 맞출 수 있으며, 사용자는 자신이 어떤 체인에 자산을 예치했는지 신경 쓰지 않고도 다양한 네트워크에서 동일하게 대출 및 예치를 할 수 있다.

- **Multi Chain Liquidity 구조 도입 전**
	- 사용자가 이더리움 풀에 1,000 USDC를 예치했다고 가정하자.
	- 이 자산은 오직 이더리움 풀 안에서만 활용된다.
	- 이더리움 풀은 유동성이 과잉이라 공급 금리가 2%에 머무는 반면, 아비트럼 풀은 유동성이 부족해 대출 금리가 10%까지 치솟는다.
	- 결국, 두 풀은 서로 연결되지 있지 않은 다른 풀이므로, 금리 격차와 자본 비효율이 발생한다.
- **Multi Chain Liquidity 구조 도입 후**
	- 브릿지를 기반으로 이더리움 풀의 남아있던 자산 일부가 아비트럼 풀로 이동 및 공유된다.
	- 이로 인해 이더리움 풀은 과잉 유동성이 줄어들어 공급 금리가 2% → 4~5%로 상승한다.
	- 반대로 아비트럼 풀은 부족했던 유동성이 채워지면서 대출 금리가 10% → 6~7% 수준으로 하락한다.
	- 결국 두 체인의 금리는 서로 균형을 찾아가고, 사용자는 더 안정적이고 효율적인 수익을 여러 체인에서 동시에 누릴 수 있게 된다.

# 8. Risk ( Oracle Manipulation, Flash Loan
### Oracle Manipulation 공격
DeFi 프로토콜은 자산 가치를 평가할 때 오라클에 의존하기 때문에, 가격 데이터가 조작될 경우 심각한 리스크가 발생한다. 특히 특정 거래소에 과도하게 의존하는 오라클은 공격자가 시장을 인위적으로 움직여 가격을 왜곡시키는 방식으로 악용될 수 있다. 이로 인해 담보 자산이 과대평가되거나 저평가되어, 대출자와 프로토콜 모두에게 피해가 발생할 수 있다.

대표적인 사례로 **Mango Markets 해킹(2022, Solana DeFi)** 이 있다. 해커는 자체 토큰(MNGO)을 대량 매수하여 가격을 급등시켰고, 오라클은 짧은 그 순간의 조작된 가격을 그대로 반영하였기에 MNGO의 가격은 10분 만에 약 200% 이상 급등했다가 80%이상 하락했다. 결과적으로 공격자는 과대평가된 MNGO를 담보로 대규모 대출을 실행하여 1억 달러 이상의 피해를 발생시켰다. 이 사건은 유동성이 부족한 토큰을 담보로 허용할 경우 시스템이 얼마나 쉽게 무너질 수 있는지를 보여준 대표적 사례이다.

![Mango Markets 해킹](DeFi의%20Lending/file-20250819180641035.png)
### Flash Loan 공격
Flash Loan은 담보 없이 하나의 트랜잭션 안에서 빌리고, 사용하고, 상환까지 완료되는 특수한 대출 방식이다. 이는 블록체인에서 순간적으로 사실상 무한대의 유동성을 활용할 수 있게 해주며, 공격자들은 이 기능을 시장 및 오라클 조작에 활용하여 단기간에 막대한 이익을 챙길 수 있는 위협이 존재한다.

실제 사례로는 **Pancake Bunny 공격(2021, Binance Smart Chain DeFi)** 이 있다. 공격자는 플래시 론을 이용해 특정 토큰의 가격을 인위적으로 끌어올린 후 급격히 매도하여 큰 차익을 실현함으로 서 가격이 80%이상 하락 했다. 이로 인해 수백만 달러 규모의 피해가 발생했으며, BSC 기반 DeFi 생태계의 보안 취약성과 플래시 론 공격의 파급력을 드러낸 사건으로 기록된다.

![Pancake Bunny 공격](DeFi의%20Lending/file-20250819181932462.png)
